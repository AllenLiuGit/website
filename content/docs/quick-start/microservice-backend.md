+++
title = "创建一个微服务后端服务"
description = ""
weight = 3
type = "docs"
+++

# 创建一个应用后端服务
---

## 目标

应用后端(Microservice)的架构模式是将传统的单体应用拆分成多个小型服务，每个小型服务可以独立的编译和部署，服务之间的调用通过HTTP的restfull API方式进行通讯。它们彼此之间相互协作，作为一个整体对外开放。Choerodon 的应用后端采用SpringBoot、SpringCloud 作为微服务的开发框架，利用丰富的文档、社区活跃和一套完整的应用框架解决方案提供技术支持。

本章节将从创建应用后端、开发应用后端、生成版本、发布服务、部署服务、查看运行信息等方面介绍，让读者能够熟悉使用Choerodon创建应用后端服务的步骤和流程，并且学会如何利用Choerodon发布版本和部署服务等。

## 前置条件

- 在操作之前保证[系统配置](../../user-guide/system-configuration)已经配置完全。特别在本章节用到的角色、环境管理等配置。
- 完成[创建项目](../project)操作。本章节使用在前面章节创建的`演示proj`项目。

<h2 id="1">创建应用后端</h2>

1. 使用项目所有者或者源代码管理员的角色登录Choerodon系统，选择新建的项目``演示proj``,
2. 选择``持续交付``模块，点击`应用`，进入应用管理页面；
3. 点击``创建应用``，系统会弹出模态框，在框中输入应用编码、应用名称和选择应用模板；

    a. 应用编码：`order-apply`

    b. 应用名称：`订单应用`

    c. 选择应用模板: `MicroService`

    > 应用编码输入只能包含小写字母、数字、中划线(-)、英文句号(.)和反斜杠(\)，应用名称输入最大64个字符。
4. 点击创建，即可创建一个应用后端服务。

4. 当应用创建成功，可以在应用列表查看到新建的应用。

    ![](/img/docs/quick-start/assets/microservice-backend/应用创建.png)

3. 在创建服务的同时，系统还会在Gitlab中创建一个仓库，点击 ``仓库地址`` ，链接到Gitlab新建的仓库。

    ```
    http://git.saas.hand-china.com/devops/order-apply.git
    ```

    > Gitlab 仓库的名称是 ``order-apply``，是应用编码。

    
    
 
<h2 id="2">开发应用后端</h2>

应用创建完成之后，开发应用后端。具体的操作步骤如下：

1. 创建Feature分支。

    进入到应用管理界面，选择应用编码order-apply，点击右侧分支管理，选择创建分支，系统会弹出侧边栏，填写字段（包含字母、数字、'——'、'_'），点击创建按钮，即可创建一个Feature分支。
    ![](/img/docs/quick-start/assets/microservice-backend/创建分支.png)

2. 在存放代码的文件夹下，打开git bash,输入命令`git clone [仓库地址]`，拉取所需服务的代码仓库。


3. 克隆成功之后，进入项目根目录，打开git bash,输入命令`git checkout feature-1`,切换到新建分支feature-1，并在此分支进行开发。

    ```shell
    $ git checkout feature-1
    ```


4. 提交代码。    

    ```shell
    # 将本地代码变动提交到暂存区
    $ git add .
    # 提交代码并且为本次提交添加 commit 信息
    # 注：[FIX]修改bug  [ADD]新增  [IMP]完善  [DEL]删除
    $ git commit –m “[ADD]readme: 新增代码示例”
    # 将本地提交推送至远程仓库对应分支
    $ git push origin feature-1:feature-1
    ```

5. 基于feature分支运行CI。点击`CI流水线`,查看 CI 执行情况。

    ![](/img/docs/quick-start/assets/microservice-backend/流水线.png)

6. 点击应用，进入应用管理，点击所创应用的`分支管理`，在分支列表找到`feature-1`，点击`结束分支`。

<h2 id="3">生成版本</h2>

 应用版本是代码提交的历史记录，每提交一次修改后的代码，对应生成一个新的版本。具体的操作步骤如下：

1. 结束分支之后，`feature-1`分支的代码会合并到`develop`分支，并触发Gitlab CI。点击``CI流水线``,查看CI执行情况。

    <blockquote class="note">
        Choerodon 缺省的 CI 流程有三个阶段:
        <ul>
            <li>单元测试，编译打包，代码质量检查</li>
            <li>构建docker镜像</li>
            <li>创建服务版本</li>
        </ul>
    </blockquote>

    ![](/img/docs/quick-start/assets/microservice-backend/流水线1.jpg)

1. 点击`应用版本`进行查看，确定服务版本已经生成。


<h2 id="5">部署应用</h2>

提供可视化、一键式部署应用，支持并行部署和流水线无缝集成，实现部署环境标准化和部署过程自动化。具体的操作步骤如下：

1. 确认部署时需要使用的资源已配置完全。[资源配置](../../user-guide/continuous-deployment#资源管理)

1. 使用部署管理员的角色登录Choerodon系统，选择``演示proj``,在菜单栏选择`应用部署`，进入应用部署界面，点击`部署应用`，依次勾选`选择应用``选择版本``选择环境``，点击部署即可。

    注：服务第一次部署需要自己手动填写资源，再次部署页面会显示上一次部署选择的资源。选择资源一定要谨慎，选择错误严重会导致数据库数据丢失。

1. 为所选的应用将网关信息注册至应用管理服务，注册后，该应用才能正常访问。[网关管理](../../user-guide/continuous-deployment#网关管理)

<h2 id="6">查看运行信息</h2>

进入持续交付模块，选择应用部署，点击部署应用即可查看运行状态。有四种查看视图，分别为：部署实例、单环境单应用、多应用。

那么如何判断这个服务版本已经部署成功？当可用容器数量、当前容器状态为1时，代表该服务版本已经部署成功了。
 在服务版本界面，右侧的`查看部署详情`，进入到查看部署详情界面。点击`部署详情`可以查看到阶段信息及日志。