+++
title = "监控"
description = ""
weight = 2
banner = "img/banners/banner-1.jpg"
+++

提供全方位的监控服务，包括基础组件监控，各微服务运行情况监控，资源监控和智能预警

架构图如下

![监控架构图](/img/docs/installation-configuration/development/monitoring-structure.jpeg)
<!--more-->

# 安装

## 下载安装脚本
   
  ```bash
  # wget https://rdc.hand-china.com/gitlab/rdc_hip/devops-install-docs/raw/master/devops/monitoring/install_monitoring.sh 
  ```
    
  
## 编辑参数
  
  ```bash
  # vim install_monitoring.sh
  ```

  参数说明

参数 | 说明 | 默认值  
--- | --- | --- 
NAMESPACE |监控服务所在的命名空间| monitoring 
REQUEST_MEMORY |prometheus请求的内存大小 | 4Gi  
LIMIT_MEMORY | prometheus限制的内存大小 | 8Gi 
SCRAPE_INTERVAL|prometheus收集指标间隔 | 10s
SCRAPE_TIMEOUT |prometheus收集指标超时 | 10s
BASE_URL| 服务的基础地址，如想要prometheus的地址为prometheus.example.com则BASE_URL的值应该设置为`example.com`| 
NFS_SERVER|如果需要nfs存储监控数据则需要制定nfs服务器地址|

## 运行前注意事项

- 脚本默认支持主机存储和nfs存储，如果需要使用glusterfs或者ceph请手动搜索`create_pv_datalocaltion`方法并将如下文本中关于nfs的内容替换成所需的存储方式。

```yml
---
apiVersion: v1
kind: PersistentVolume
metadata:
  labels:
    pv: ${name}
  name: ${name}
spec:
  accessModes:
  - ReadWriteMany
  capacity:
    storage: ${storage_size}Gi
  nfs:
    path: ${dataPath}
    server: ${NFS-SERVER}
```

## 运行脚本

    ```bash
    # sh install_monitoring.sh
    ```

    根据提示输入相关参数：

    - Do you want use pvc to storage prometheus/grafana data (default is no) yes/no：   
      是否使用pvc存储prometheus/grafana数据

    - which node you run with prometheus/grafana 
      
      选择prometheus/grafana可以运行的节点，根据提示的节点选择如`node1 node3`
    
    - what nfs size do you want assign to prometheus (unit Gi)

      如果使用pvc，输入分配给prometheus的空间大小单位是Gi

##  查看服务

|服务  | 地址|
|--- | ---| 
|grafana | grafana.example.com |
|prometheus| prometheus.example.com |
|alertmanager| alertmanager.example.com |